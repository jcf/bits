#+title:   Bits
#+startup: content

Platforms control your audience. Payment processors control your revenue. Bits
gives you both back.

*What you get:*

- Subscriptions, one-time purchases, digital downloads
- Video hosting and delivery
- Your data, your domain, your rules
- Permissive content policies for persecuted creators

*Why it works:*

- Self-host on a $5/month VPS or use managed hosting
- Single binary deployment - no complex setup
- Built with care to minimize resource usage and maximize reliability
- Open source - audit the code, modify what you need, contribute back

*The model:* Like WordPress.org - free to self-host, managed option available.
You're never locked in.

*Current state:* Active development. Your funding accelerates delivery.

* Development
#+begin_src sh :eval never
devenv up
#+end_src

** HTTPS and =*.test= URLs
*** Setup
To get our =*.test= URLs to work takes some effort with DNS.

#+begin_src sh :results output table :colnames '("Host" "Address")
drill bits.test | awk '/^bits/ { print $1 "\t" $5 }'
#+end_src

#+results:
| Host       |   Address |
|------------+-----------|
| bits.test. | 127.0.0.1 |

#+begin_src sh :results output verbatim
cat /etc/resolver/test
#+end_src

#+results:
: nameserver 10.10.10.254

*** Test
#+begin_src sh :results output verbatim :shebang "#!/usr/bin/env zsh"
urls=(
  https://www.usebits.app.test
  https://bits.page.test
  https://jcf.bits.page.test
)

for url in $urls; do
  http_code="$(curl --silent --output /dev/null --write-out "%{http_code}" "$url")"
  if [ "$http_code" -eq 200 ]; then
    echo "✅ $url"
  else
    echo "❌ $url ($http_code)"
  fi
done
#+end_src

#+results:
: ❌ https://www.usebits.app.test (502)
: ❌ https://bits.page.test (502)
: ❌ https://jcf.bits.page.test (502)

And with a non-existent tenant, we expect a 404 response:

#+begin_src sh :results output verbatim
url="https://foo.bits.page.test"
http_code="$(curl --silent --output /dev/null --write-out "%{http_code}" "$url")"

if [ "$http_code" -eq 404 ]; then
  echo "✅ $url"
else
  echo "❌ $url ($http_code)"
fi
#+end_src

#+results:
: ❌ https://foo.bits.page.test (502)

** Decision records
#+begin_src sh :results output raw :exports output :exports results
fd --type file '\.org$' decisions | while read -r file; do
  title=$(awk -F':[[:space:]]*' 'NR==1 { print $2 }' "$file")
  echo "- [[file:$file][$title]]"
done
#+end_src

#+results:
- [[file:decisions/20251009133634-get-the-message-out.org][Get the message out]]
- [[file:decisions/20251009144920-python-style-environment-variables.org][Python-style environment variables]]
- [[file:decisions/20251118100535-mission-over-saas-startup-playbook.org][Mission over SaaS startup playbook]]
- [[file:decisions/20251119230950-ci-can-wait.org][CI can wait]]
- [[file:decisions/20251129175326-clojure-over-rust.org][Clojure over Rust]]

** Dev tasks
#+begin_src sh :results output verbatim :exports results
just --list
#+end_src

#+results:
#+begin_example
Available recipes:
    [dev]
    fmt              # Format project files
    lint             # Run lints
    market           # Run the marketing site
    mkcert           # Create self-signed SSL certificates via mkcert
    nrepl *args
    setup            # Setup a local development environment
    tailwind         # Watch source code for Tailwind classes
    test             # Run tests

    [docs]
    decide +title    # Create a new decision record

    [iac]
    apply dir        # Apply one or all Terraform projects
    init dir *args   # Initialize one or all Terraform projects
    output dir *args # Interact with outputs one or all Terraform projects
    plan dir         # Plan one or all Terraform projects

    [postgres]
    migration name   # Create a new migration
    psql *args       # Start an interactive psql session connected to the local development database
#+end_example

** SLOC
#+begin_src sh :results output verbatim :exports results
tokei
echo
echo "$(git describe --always --dirty --abbrev=7) @ $(date +"%Y/%m/%d %H:%M")"
#+end_src

#+results:
#+begin_example
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 Language              Files        Lines         Code     Comments       Blanks
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 Astro                    10          165          139            0           26
 Clojure                  28         2800         2250          195          355
 CSS                       2            6            6            0            0
 Edn                       1           94           82            3            9
 HCL                      12          389          323           13           53
 JavaScript                5          195          150           13           32
 JSON                      4           58           58            0            0
 Just                      1          182          111           41           30
 MDX                       1           56            0           39           17
 Nix                       1          255          209            8           38
 Org                      10         1621         1465            4          152
 TOML                      1           36           32            0            4
 TypeScript                3           36           30            1            5
 XML                       1           18           14            1            3
 YAML                      3         5053         3968            0         1085
─────────────────────────────────────────────────────────────────────────────────
 Markdown                  1           36            0           23           13
 |- Rust                   1           68           49           10            9
 (Total)                              104           49           33           22
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 Total                    84        11068         8886          351         1831
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

9ed5dcb @ 2026/02/06 16:31
#+end_example

** TODOs
#+begin_src sh :results output verbatim :exports results
rg --glob '!README.org' 'TODO|FIXME' </dev/null | sort
#+end_src

#+results:
: src/bits/assets.clj:;; TODO Make content-type explicit or more intelligent.
: src/bits/service.clj:                    ;; TODO Bring back sessions
: src/bits/session.clj:;; TODO Improve these names.
