:properties:
:header-args:sql:  :engine     postgresql
:header-args:sql+: :dbhost     "localhost"
:header-args:sql+: :database   "bits_dev"
:header-args:sql+: :dbuser     "bits"
:header-args:sql+: :dbpassword "please"
:end:
#+title:    PostgreSQL
#+startup:  content
#+property: header-args :dir ..

* Users
** Select all
#+begin_src sql
select
  u.id as user_id,
  e.address,
  e.valid_from,
  e.valid_to,
  u.created_at
from users u
join email_addresses e on e.user_id = u.id;
#+end_src

#+results:
| user_id | address              | valid_from                    | valid_to | created_at                    |
|---------+----------------------+-------------------------------+----------+-------------------------------|
|       1 | james@invetica.co.uk | 2025-12-05 16:07:01.366019+00 | infinity | 2025-12-05 16:07:01.364261+00 |
|       2 | a@a.a                | 2025-12-05 16:07:16.321656+00 | infinity | 2025-12-05 16:07:16.321656+00 |

** Delete others
#+begin_src sql :eval query
delete from users where id > 1;
#+end_src

#+results:
| DELETE 0 |
|----------|

** Logins view
#+begin_src sql
select user_id, email, verified from logins;
#+end_src

#+results:
| user_id | email                | verified |
|---------+----------------------+----------|
|       1 | james@invetica.co.uk | t        |
|       2 | a@a.a                | f        |
